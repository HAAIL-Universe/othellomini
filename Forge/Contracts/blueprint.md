# OthelloMini Blueprint

## 1. Product Intent

OthelloMini is a proof-of-concept ethics-first AI life intelligence platform that provides consent-gated personalized guidance through a multi-agent architecture. Targeted at individuals seeking deeply personalized AI assistance for life decisions and self-improvement, the system maintains a persistent user model (digital shadow) while enforcing transparent ethical boundaries. The MVP demonstrates the core value proposition: AI-powered suggestions filtered through user-controlled consent tiers (Passive → Suggestive → Active → Autonomous), delivered via a warm conversational chat interface. This mini build validates the ethical filtering mechanism (Othello as gatekeeper), basic psychological modeling (FELLO core agent), and proactive suggestion surfacing, constrained to a 2-phase implementation.

## 2. Core Invariants

1. **Consent primacy**: No proactive action or suggestion reaches the user without passing through the consent tier filter; user autonomy settings are immutable without explicit user intent.
2. **Ethical gatekeeping**: All outputs must transit through the Othello ethics layer and log validation reasoning before delivery; no bypass paths.
3. **Transparency on demand**: Every suggestion or model inference must be traceable to agent reasoning and ethical validation; logs are user-accessible without requiring technical knowledge.
4. **Digital shadow persistence**: User psychological model (traits, patterns, preferences) is continuously updated and survives sessions; no ephemeral modeling.
5. **Chat-first interaction**: All user engagement flows through the conversational interface; settings and controls are secondary affordances, not primary navigation.

## 3. MVP Scope

### In Scope (2-Phase Build)

**Phase 1: Backend + Core Logic**
- User authentication and session management (simple JWT-based auth)
- Chat message ingestion and response generation API
- Othello ethics filter with four consent tiers (Passive, Suggestive, Active, Autonomous)
- FELLO core agent: single unified agent performing basic psychological modeling (traits, preferences tracking)
- Digital shadow storage: persistent user profile with trait vectors, conversation history, preference logs
- Consent management API: GET/PUT user autonomy tier settings
- Suggestion queue: proactive suggestions generated by FELLO, filtered by Othello, stored pending user consent
- Transparency logging: agent reasoning and ethical validation logs tied to each message/suggestion

**Phase 2: Frontend + User Experience**
- Chat interface: full-screen conversational UI with message history
- Inline consent prompts: approve/deny/adjust cards within chat flow for queued suggestions
- Collapsible transparency panel: agent reasoning trace, ethical validation logs, digital shadow summary (on-demand)
- Settings page: autonomy tier controls, basic profile management
- Dark theme with muted accents (navy/charcoal base, teal/amber highlights)
- Mobile-responsive chat layout with touch-optimized controls

### Explicit Not-in-Scope

- Multi-agent specialization (sub-agents for mood, aspirations, behavior tracking) → deferred to full build
- RealityAgent proactive interventions (calendar integration, routine nudges, external scheduling) → deferred
- Advanced psychological modeling (mood tracking, temporal pattern analysis) → deferred
- Third-party integrations (calendar, email, fitness APIs) → deferred
- Multi-user households or shared profiles → single user only
- Voice/audio interface → text chat only
- Real-time collaborative features or social sharing → single-player experience
- Advanced analytics dashboard or data export → basic transparency logs only
- Custom agent configuration or plugin architecture → fixed agent logic

## 4. Layer Boundaries

### API/Routes Layer
- **Responsibility**: HTTP request handling, authentication middleware, input validation, response serialization
- **Boundaries**: Accepts JSON payloads, validates schema, invokes service layer methods, returns HTTP responses; no business logic or direct data access
- **Key endpoints**:
  - `POST /auth/register`, `POST /auth/login`
  - `POST /chat/message` → send user message, receive AI response
  - `GET /chat/history`
  - `GET /suggestions` → fetch pending consent-gated suggestions
  - `POST /suggestions/:id/respond` → approve/deny suggestion
  - `GET /settings/consent` → get current autonomy tier
  - `PUT /settings/consent` → update autonomy tier
  - `GET /transparency/logs/:messageId` → fetch reasoning trace for specific interaction

### Service Layer
- **Responsibility**: Orchestration of business logic, agent invocation, ethical filtering, consent evaluation, transparency log generation
- **Boundaries**: Invoked by routes; calls repositories for persistence; coordinates multi-step workflows (e.g., message → FELLO → Othello → response); no HTTP concerns, no raw SQL
- **Key services**:
  - `AuthService`: user registration, login, token generation
  - `ChatService`: message processing, FELLO agent invocation, response assembly
  - `OthelloService`: ethical filtering, consent tier evaluation, suggestion approval logic
  - `FELLOService`: psychological modeling, digital shadow update, suggestion generation
  - `TransparencyService`: reasoning log creation, validation trace assembly

### Repository Layer
- **Responsibility**: Data persistence and retrieval; encapsulates database queries
- **Boundaries**: Invoked by services; returns domain objects/DTOs; no business logic, no agent logic
- **Key repositories**:
  - `UserRepository`: CRUD for user accounts, authentication credentials
  - `ConversationRepository`: message history storage/retrieval
  - `DigitalShadowRepository`: user psychological profile (traits, preferences, patterns)
  - `SuggestionRepository`: pending suggestions with consent state
  - `TransparencyLogRepository`: agent reasoning and ethical validation logs

### Agent Layer (Domain Logic)
- **Responsibility**: AI inference, psychological modeling, suggestion generation, ethical reasoning
- **Boundaries**: Invoked by services; stateless logic; interacts with LLM APIs or rule engines; returns structured outputs (suggestions, model updates, ethical verdicts)
- **Key agents**:
  - `FELLOAgent`: core personalization agent; updates digital shadow, generates contextual suggestions
  - `OthelloGate`: ethical filter; evaluates outputs against user consent tier, flags violations, logs reasoning

### Data Layer
- **Responsibility**: Database schema, migrations, ORM models
- **Boundaries**: PostgreSQL or SQLite for persistence; schema versioned via migrations; accessed only through repository layer

## 5. Deployment

### Local Development
- **Docker Compose** setup with:
  - Backend service (Python FastAPI or Flask)
  - Frontend service (React or Vue dev server)
  - PostgreSQL database (or SQLite for ultra-lightweight option)
  - Environment configuration via `.env` file (DB credentials, JWT secret, LLM API keys)
- **Hot reload** enabled for both frontend and backend during development
- **Seed data** script: initial user, sample conversation, pre-populated digital shadow for demo

### Build Artifacts
- Backend: `Dockerfile` with Python dependencies, WSGI server (Gunicorn/Uvicorn)
- Frontend: `Dockerfile` with Node build, static asset output served via Nginx or bundled into backend
- Single `docker-compose.yml` orchestrating all services for one-command startup

### Configuration
- **Environment variables**:
  - `DATABASE_URL`
  - `JWT_SECRET`
  - `LLM_API_KEY` (OpenAI or equivalent)
  - `CONSENT_TIER_DEFAULT` (default autonomy level for new users)
  - `LOG_LEVEL`
- **No external dependencies** beyond LLM API; fully self-contained local deployment

### Minimal Production Readiness
- Health check endpoints (`/health`)
- Structured logging (JSON format)
- Graceful shutdown handling
- Database migration runner (Alembic or equivalent)
- Not required for MVP: load balancing, CDN, horizontal scaling, monitoring dashboards (deferred to full production build)